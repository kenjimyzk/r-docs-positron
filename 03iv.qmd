---
title: "R使い方入門：操作変数法"
format: 
    html:
      toc: true
      toc-depth: 2
      number-sections: true
    docx: default 
    pdf:
      pdf-engine: lualatex
      documentclass: ltjsarticle
      classoption: lualatex,ja=standard
editor: source
---

## 操作変数法（Instrumental Variables Method）

回帰分析において、説明変数と誤差項が相関している場合（内生性がある場合）、通常の最小二乗法（OLS）による推定量はバイアスを持ち、一致性を失います。教育年数が賃金に与える影響を推定するミンサー方程式の例では、個人の「能力」などの観察できない要因が、教育年数と賃金の両方に影響を与える可能性があります。この場合、教育年数の係数は過大評価（上方バイアス）される傾向があります。

このような内生性の問題に対処するために用いられるのが**操作変数法（IV法）**です。

### データの読み込み

まず、データを読み込みます。ここでは `8_income.csv` を使用します。

```{r}
income8 <- read.csv("8_income.csv")
head(income8)
```

### OLSによる推定（ベースライン）

比較のために、まずは通常の最小二乗法（OLS）でミンサー方程式を推定します。

```{r}
reg1 <- lm(lincome ~ yeduc + exper + exper2, data = income8)
summary(reg1)
```

`summary(reg1)` の結果を確認すると、教育年数 `yeduc` の係数は正で有意であることがわかります。しかし、前述の通り、この推定値には内生性によるバイアスが含まれている可能性があります。

### 操作変数法による推定

次に、操作変数法を用いて推定を行います。
ここでは、本人の教育年数 `yeduc` の操作変数として、親の教育年数（あるいは学費の支払い能力などに関連する変数と想定される）`payeduc` を使用します。

操作変数が満たすべき条件は以下の2つです：
1.  **関連性（Relevance）**: 操作変数（`payeduc`）は内生変数（`yeduc`）と相関していること。
2.  **外生性（Exogeneity）**: 操作変数（`payeduc`）は誤差項とは相関していないこと（賃金に対して、教育年数を通じた経路以外で直接的な影響を持たないこと）。

Rで操作変数法を行うには、`AER` パッケージの `ivreg()` 関数が便利です。

```{r}
library(AER)

# 操作変数法による推定
# 式の書き方: 従属変数 ~ 内生変数 + 外生変数 | 操作変数 + 外生変数
ivreg1 <- ivreg(lincome ~ yeduc + exper + exper2 |
    exper + exper2 + payeduc, data = income8)
summary(ivreg1)
```

`ivreg()` の式の `|` の右側には、**モデルに含まれるすべての外生変数**（ここでは `exper`, `exper2`）と、**操作変数**（`payeduc`）を記述します。内生変数である `yeduc` は右側には含めません。

### 結果の解釈

OLSの結果（`reg1`）とIV法の結果（`ivreg1`）を比較してみましょう。

- **OLS推定値（`yeduc`）**: 約 0.084
- **IV推定値（`yeduc`）**: 約 0.075

OLSによる教育年数の収益率（約8.4%）と比較して、操作変数法による推定値（約7.5%）は小さくなりました。
これは、OLS推定値が「能力」などの観察されない要因によって上方バイアスを持っていた（過大評価されていた）という仮説と整合的です。能力が高い人は教育年数が長く、かつ賃金も高い傾向があるため、能力をコントロールできないOLSでは教育の効果が実際よりも大きく推定されてしまう傾向があります。操作変数法を用いることで、このバイアスを取り除き、より純粋な教育の効果に近づくことができました。

ただし、IV推定値も依然として統計的に有意であり、教育が賃金に正の効果を与えるという結論自体は変わりません。
